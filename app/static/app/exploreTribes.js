let data1 = [{ "type": "Feature", "properties": { "Name": "Warwa", "description": "https:\/\/native-land.ca\/maps\/languages\/warwa-2\/", "Slug": "warwa", "color": "#2C00EE" }, "geometry": { "coordinates": [[[123.502807, -17.056784], [123.579711, -17.135541], [123.684082, -17.277218], [123.777465, -17.345395], [123.870849, -17.350638], [124.118041, -17.392579], [124.282836, -17.43451], [124.425659, -17.439751], [124.486083, -17.439751], [124.508056, -17.282463], [124.508056, -17.135541], [124.502563, -17.041029], [124.48059, -16.893915], [124.469604, -16.841347], [124.343261, -16.830832], [124.194946, -16.830832], [124.052124, -16.815057], [123.95874, -16.815057], [123.859863, -16.857119], [123.766479, -16.920194], [123.651123, -16.972741], [123.579711, -16.988502], [123.502807, -17.056784]]], "type": "Polygon" }, "id": "0078efb2a719da5ac03b2d6f74b13183" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/takalak-2\/", "Slug": "takalak", "Name": "Takalak", "color": "#0111CC" }, "geometry": { "coordinates": [[[142.76184, -17.832374], [142.613525, -17.931702], [142.56958, -18.015303], [142.597045, -18.187606], [142.690429, -18.333669], [142.789306, -18.500447], [142.893676, -18.682675], [142.976074, -18.755511], [143.129882, -18.693082], [143.393554, -18.594188], [143.563842, -18.479609], [143.563842, -18.187606], [143.497924, -17.821915], [143.481445, -17.58643], [143.333129, -17.397821], [143.21228, -17.334908], [143.074951, -17.43451], [142.921142, -17.644022], [142.855224, -17.759149], [142.76184, -17.832374]]], "type": "Polygon" }, "id": "00b64207314c0fa00b693eee0cbe7689" }, { "type": "Feature", "properties": { "Name": "Chipaya", "Slug": "chipaya", "description": "https:\/\/native-land.ca\/maps\/languages\/chipaya\/", "color": "#0911EE" }, "geometry": { "coordinates": [[[-67.119852, -18.050935], [-66.808524, -18.275754], [-66.50965, -18.630138], [-66.360212, -18.972009], [-66.596821, -19.183853], [-67.107399, -19.301426], [-67.617976, -19.465888], [-67.754961, -19.395425], [-68.190819, -19.172091], [-68.427428, -19.125034], [-68.614225, -19.054425], [-68.738756, -18.889552], [-68.788569, -18.689131], [-68.801022, -18.429411], [-68.801022, -18.240276], [-68.601772, -18.110126], [-68.365163, -18.003568], [-68.066288, -17.896946], [-67.630429, -17.908796], [-67.119852, -18.050935]]], "type": "Polygon" }, "id": "00ba22aac6adb9ef6c869cc16f330a32" }, { "type": "Feature", "properties": { "Name": "Kija", "description": "https:\/\/native-land.ca\/maps\/languages\/kija-2\/", "Slug": "kija", "color": "#E70099" }, "geometry": { "coordinates": [[[127.408447, -16.077485], [127.353515, -16.415009], [127.320556, -16.667767], [127.364501, -16.909683], [127.496337, -17.203769], [127.342529, -17.329664], [127.144775, -17.382094], [126.958007, -17.497389], [126.705322, -17.57072], [126.452636, -17.685895], [126.221923, -17.727758], [126.057128, -17.926475], [125.936279, -18.062312], [125.99121, -18.114529], [126.254882, -18.093644], [126.485595, -18.135411], [126.595458, -18.250219], [126.705322, -18.385804], [126.738281, -18.479609], [126.892089, -18.479609], [127.029418, -18.469188], [127.199707, -18.411866], [127.386474, -18.333669], [127.545776, -18.260653], [127.683105, -18.171949], [127.864379, -18.020527], [128.056637, -17.936928], [128.232419, -17.717293], [128.298339, -17.549771], [128.430174, -17.560246], [128.638916, -17.61261], [128.781737, -17.664959], [128.880615, -17.780074], [128.979492, -17.811456], [129.056396, -17.85329], [129.023437, -17.623081], [128.946531, -17.392579], [128.891601, -17.172282], [128.858642, -16.983248], [128.825683, -16.815057], [128.80371, -16.69934], [128.902587, -16.646718], [129.111325, -16.625665], [129.265136, -16.625665], [129.342041, -16.457158], [129.287106, -16.341225], [129.221191, -16.267413], [129.012451, -16.140815], [128.627929, -16.077485], [128.331298, -15.993014], [128.078612, -15.876809], [127.803955, -15.866241], [127.551269, -15.971891], [127.408447, -16.077485]]], "type": "Polygon" }, "id": "00d6694aca9626984ef67cb82ed4abb3" }, { "type": "Feature", "properties": { "Name": "Jiwarli", "description": "https:\/\/native-land.ca\/maps\/languages\/jiwarli-2\/", "Slug": "jiwarli", "color": "#F82266" }, "geometry": { "coordinates": [[[115.889282, -22.619082], [115.806885, -22.740723], [115.751953, -22.806567], [115.697021, -22.907803], [115.86731, -22.998852], [116.213379, -23.200961], [116.553955, -23.377556], [116.883545, -23.528737], [117.355957, -23.745126], [117.564697, -23.825551], [117.658081, -23.865745], [117.778931, -23.755182], [117.822876, -23.579092], [117.723999, -23.473324], [117.333984, -23.372514], [117.097778, -23.306946], [116.856079, -23.20601], [116.669312, -23.089838], [116.455078, -22.968509], [116.251831, -22.892623], [116.087036, -22.796439], [116.004639, -22.720457], [115.9552, -22.639363], [115.889282, -22.619082]]], "type": "Polygon" }, "id": "01639ceeae92a307329f734af0b45621" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/amuzgo-3\/", "Name": "Amuzgo", "Slug": "amuzgo", "color": "#3111EE" }, "geometry": { "coordinates": [[[-98.846751, 16.709869, 0], [-99.12691, 16.783514, 0], [-99.537561, 16.828309, 0], [-99.577362, 16.701977, 0], [-99.00331, 16.591453, 0], [-98.552856, 16.591449, 0], [-98.143607, 16.628302, 0], [-97.932114, 16.862388, 0], [-98.080432, 17.232654, 0], [-98.305661, 17.264132, 0], [-98.390806, 17.185426, 0], [-98.475949, 16.92809, 0], [-98.846751, 16.709869, 0]]], "type": "Polygon" }, "id": "02507f692050a78ddfa1ea6b3893a9bf" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/chatino-2\/", "Name": "Chatino", "Slug": "chatino", "color": "#B52211" }, "geometry": { "coordinates": [[[-97.441864, 16.670728, 0], [-97.516365, 16.432379, 0], [-97.437744, 16.172472, 0], [-97.454223, 15.993014, 0], [-97.212524, 15.866241, 0], [-96.987304, 15.850389, 0], [-96.888427, 16.151368, 0], [-96.874694, 16.386026, 0], [-97.047729, 16.462426, 0], [-97.169094, 16.791599, 0], [-97.441864, 16.670728, 0]]], "type": "Polygon" }, "id": "037c872841236f58609300e0a0bf0482" }, { "type": "Feature", "properties": { "Name": "Chakchiuma", "description": "https:\/\/native-land.ca\/maps\/languages\/chakchiuma\/", "Slug": "chakchiuma", "color": "#BB0044" }, "geometry": { "coordinates": [[[-90.725098, 33.94336, 0], [-90.769043, 33.578015, 0], [-90.197754, 33.468108, 0], [-89.34082, 33.523079, 0], [-89.077148, 33.596319, 0], [-89.01123, 34.034453, 0], [-89.736328, 34.161818, 0], [-90.65918, 33.979809, 0], [-90.725098, 33.94336, 0]]], "type": "Polygon" }, "id": "03c4eabd0fa6fb96bca6642a6f7eae27" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/tahues-2\/", "Name": "Tahues", "Slug": "tahues", "color": "#BB00EE" }, "geometry": { "coordinates": [[[-108.110961, 25.507742, 0], [-107.924194, 25.542441, 0], [-108.001098, 25.254632, 0], [-107.836303, 25.160201, 0], [-107.567138, 24.981078, 0], [-107.545166, 24.756808, 0], [-107.583618, 24.537129, 0], [-107.468261, 24.487148, 0], [-107.528686, 24.367113, 0], [-107.440795, 24.287026, 0], [-106.946411, 23.91597, 0], [-106.666259, 24.116674, 0], [-107.050781, 24.45715, 0], [-107.325439, 24.876469, 0], [-107.336425, 25.204941, 0], [-107.62207, 25.334096, 0], [-107.687988, 25.562265, 0], [-107.468261, 25.676186, 0], [-107.578125, 25.918526, 0], [-107.737426, 26.007424, 0], [-107.858276, 25.977798, 0], [-107.968139, 25.799891, 0], [-108.110961, 25.507742, 0]]], "type": "Polygon" }, "id": "044d9d2229041b02bb74944303ee740f" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/yanda-2\/", "Slug": "yanda", "Name": "Yanda", "color": "#BD00FF" }, "geometry": { "coordinates": [[[140.350341, -21.728885], [140.218505, -22.024545], [140.218505, -22.187404], [140.339355, -22.370396], [140.723876, -22.532853], [140.976562, -22.553147], [141.053466, -22.21792], [141.020507, -21.861498], [140.822753, -21.647217], [140.614013, -21.688057], [140.350341, -21.728885]]], "type": "Polygon" }, "id": "04b67d032d4160263fabaec17561993c" }, { "type": "Feature", "properties": { "description": "https:\/\/native-land.ca\/maps\/languages\/nakara-2\/", "Slug": "nakara", "Name": "Nakara", "color": "#351177" }, "geometry": { "coordinates": [[[134.417724, -12.032605], [134.405364, -12.072895], [134.384765, -12.110494], [134.398498, -12.134662], [134.456176, -12.134662], [134.513854, -12.13332], [134.564666, -12.11855], [134.604492, -12.109151], [134.609985, -12.024546], [134.571533, -12.025889], [134.527587, -12.035291], [134.471282, -12.042006], [134.417724, -12.032605]]], "type": "Polygon" }, "id": "05218ea4efabf244ce907e1275217568" }, { "type": "Feature", "properties": { "Name": "Ab\u00e1achi Mizaa (Jicarilla)", "Slug": "jicarilla", "description": "https:\/\/native-land.ca\/maps\/languages\/jicarilla\/", "color": "#D300BB" }, "geometry": { "coordinates": [[[-104.677734, 37.125286, 0], [-104.963379, 37.230328, 0], [-105.314941, 36.686041, 0], [-105.556641, 36.155618, 0], [-105.13916, 35.657296, 0], [-104.172363, 35.424868, 0], [-103.710938, 35.478565, 0], [-103.249512, 35.924645, 0], [-103.623047, 36.244273, 0], [-104.677734, 37.125286, 0]]], "type": "Polygon" }, "id": "054d37fdc189bb000a3ebd6cb751f75b" }];

renderMap();

async function getData(url = 'https://native-land.ca/wp-json/nativeland/v1/api/index.php?maps=territories') {
    let res = await fetch(url);
    let resData = await res.json();
    return resData;
}

async function renderMap() {

    let data = await getData();

    mapboxgl.accessToken = 'pk.eyJ1IjoiZ3VycHJlZXRzaW5naG11bHRhbmkiLCJhIjoiY2txZmpsOGlrMTYzcjJvbnp0ZmJoeW1pZyJ9.PiJO1qXXB67Jl6k8FIXy7A';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/light-v10', // style URL
        center: [-98.03878868233622, 60.05083719859644], // starting position
        zoom: 2 // starting zoom
    });

    map.on('load', () => {
        // Add a data source containing GeoJSON data.
        map.addSource('maine', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'geometry': {
                    'type': 'Polygon',
                    // These coordinates outline Maine.
                    'coordinates': [[[123.502807, -17.056784], [123.579711, -17.135541], [123.684082, -17.277218], [123.777465, -17.345395], [123.870849, -17.350638], [124.118041, -17.392579], [124.282836, -17.43451], [124.425659, -17.439751], [124.486083, -17.439751], [124.508056, -17.282463], [124.508056, -17.135541], [124.502563, -17.041029], [124.48059, -16.893915], [124.469604, -16.841347], [124.343261, -16.830832], [124.194946, -16.830832], [124.052124, -16.815057], [123.95874, -16.815057], [123.859863, -16.857119], [123.766479, -16.920194], [123.651123, -16.972741], [123.579711, -16.988502], [123.502807, -17.056784]]]
                }
            }
        });


        map.addSource('national-park', {
            'type': 'geojson',
            'data': {
                'type': 'FeatureCollection',
                'features': data
            }
        });

        map.addLayer({
            'id': 'national-park+unqiue',
            'type': 'fill',
            'source': 'national-park', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': ['get', 'color'], // blue color fill
                'fill-opacity': 0.5
            }
        });

        // Add a new layer to visualize the polygon.
        map.addLayer({
            'id': 'maine',
            'type': 'fill',
            'source': 'maine', // reference the data source
            'layout': {},
            'paint': {
                'fill-color': '#0080ff', // blue color fill
                'fill-opacity': 0.5
            }
        });
        // Add a black outline around the polygon.
        map.addLayer({
            'id': 'outline',
            'type': 'line',
            'source': 'maine',
            'layout': {},
            'paint': {
                'line-color': '#000',
                'line-width': 3
            }
        });

        map.on('click', 'national-park+unqiue', (e) => {
            const coordinates = e.features[0].geometry.coordinates.slice();
            const name = e.features.map(f => {
                return f.properties.Name
            });

            let html = ``;

            for (let n of name) {
                html += `<p style='margin: 0;'><a href='#'>${n}</a></p>`
            }

            console.log(html);

            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(html)
                .addTo(map);
        });

        map.on('mouseenter', 'national-park+unqiue', (e) => {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change the cursor back to a pointer
        // when it leaves the states layer.
        map.on('mouseleave', 'national-park+unqiue', (e) => {
            map.getCanvas().style.cursor = '';
        });

        map.on('click', 'maine', (e) => {

            const description = e.features[0];

            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML('<a></a>')
                .addTo(map);
        });

        map.on('mouseenter', 'maine', () => {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change the cursor back to a pointer
        // when it leaves the states layer.
        map.on('mouseleave', 'maine', () => {
            map.getCanvas().style.cursor = '';
        });
    });
}